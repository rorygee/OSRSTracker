{% extends "base.html" %}

{% block buttons %}
<br>
<div class="btn-group" role="group" style="float: right">
    <div class="btn-group" role="group">
        <button button id="userBtnGroup" type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            User: {{ username }}
        </button>
        <span class="dropdown-menu p-4" aria-labelledby="userBtnGroup">
            <span class="form-group">
                <form action="" method="post" novalidate>
                    {{ form.hidden_tag() }}
                    <p>{{ form.username(class_="form-control", size=32) }}</p>
                    <span class="btn-group" role="group">
                        {{ form.view(class_="btn btn-primary") }}
                        {{ form.compare(class_="btn btn-primary") }}
                    </span>
                </form>
            </span>
        </span>
    </div>
    <div class="btn-group" role="group" aria-label="Record Button" data-toggle="modal" data-target="#recordModal">
        <button type="button" class="btn btn-secondary">View Records</button>
    </div>
    <div class="btn-group" role="group">
        <button id="exportBtnGroup" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Export As...
        </button>
        <div class="dropdown-menu" aria-labelledby="exportBtnGroup">
            <a class="dropdown-item" href="/export/{{ username }}.json">JSON</a>
            <a class="dropdown-item" href="/export/{{ username }}.csv">CSV</a>
        </div>
    </div>
</div>
{% endblock %}
{% block content %}
<!-- bar chart canvas element -->

<canvas id="myChart"></canvas>

{% block javascript %}
<script>

Chart.defaults.global.responsive = true;
Chart.defaults.global.maintainAspectRatio = true;

Chart.defaults.global.legend.position='bottom' ;

var chartData = {
  labels : JSON.parse({{ xpdata[0] | tojson }}),
  datasets : [
    {% for x in range(1,25) %}{
    label: '{{ keys[x] }}',
    fill: true,
    lineTension: 0.1,
    backgroundColor: "rgba({{ xpcolours[x-1] }},0.2)",
    borderColor: "rgba({{ xpcolours[x-1] }},1)",
    borderCapStyle: 'butt',
    borderDash: [],
    borderDashOffset: 0.0,
    borderJoinStyle: 'miter',
    pointBorderColor: "rgba({{ xpcolours[x-1] }},1)",
    pointBackgroundColor: "#fff",
    pointBorderWidth: 1,
    pointHoverRadius: 5,
    pointHoverBackgroundColor: "rgba({{ xpcolours[x-1] }},1)",
    pointHoverBorderColor: "rgba(220,220,220,1)",
    pointHoverBorderWidth: 2,
    pointRadius: 1,
    pointHitRadius: 10,
    data : JSON.parse({{ xpdata[x] | tojson }}),
    spanGaps: false
    }{% if x != 25 %},{% endif %}
    {% endfor %}
  ]
}

var ctx = document.getElementById("myChart").getContext("2d");

// create the chart using the chart canvas
var myChart = new Chart(ctx, {
  type: "line",
  data: chartData,
  scaleFontColor: "#000000"
});

</script> <!-- default script, will need to configure for the full table -->

{% endblock %}




<div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Records for {{ username }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>



            <div class="table-responsive">
                <table class="table table-bordered small" >
                    <tr>
                        <th>Date</th>
                        {% for x in range(1,25) %}
                        <th>{{ keys[x] }}</th>

                        {% endfor %}
                    </tr>
                    {% for record in records %}
                    <tr>
                        {% for x in range(1,26) %}
                        <td>
                            {% if (record[x]|int <= 0) and (x != 1) %}
                            N/A
                            {% else %}
                            {{ record[x] }}
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </table>
            </div>


        </div>
    </div>
</div>

<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalLabel">Add User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Modal body text goes here.</p>
            </div>

        </div>


    </div>
</div>



{% endblock %}
